<!DOCTYPE html>
<html>
<head>
<style>
  :root { --accent: #5865F2; --bg: #09090b; --card-bg: #111214; --text: #e4e4e7; --danger: #da373c; }
  body {
    background: var(--bg); color: var(--text); font-family: 'Segoe UI', system-ui;
    display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0;
    overflow: hidden;
  }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(218, 55, 60, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(218, 55, 60, 0); } 100% { box-shadow: 0 0 0 0 rgba(218, 55, 60, 0); } }

  .main-container {
    background: rgba(17, 18, 20, 0.8); backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.05); padding: 40px; border-radius: 16px;
    width: 420px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.6);
    animation: fadeIn 0.6s ease-out; position: relative;
  }

  .icon-circle {
    width: 80px; height: 80px; background: rgba(218, 55, 60, 0.1);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    margin: 0 auto 20px; animation: pulse 2s infinite;
  }
  .icon-circle svg { fill: var(--danger); width: 40px; height: 40px; }

  h1 { margin: 0 0 10px; font-size: 24px; font-weight: 700; color: white; }
  p { color: #949ba4; font-size: 14px; margin-bottom: 30px; line-height: 1.6; }

  .btn-group { display: flex; flex-direction: column; gap: 10px; }

  button {
    width: 100%; padding: 14px; border: none; border-radius: 6px;
    font-weight: 600; font-size: 14px; cursor: pointer; transition: 0.2s;
  }
  .btn-primary { background: var(--accent); color: white; }
  .btn-primary:hover { background: #4752c4; transform: translateY(-2px); }
  .btn-secondary { background: rgba(255,255,255,0.05); color: #ccc; border: 1px solid rgba(255,255,255,0.05); }
  .btn-secondary:hover { background: rgba(255,255,255,0.1); color: white; }

  .modal-overlay {
    position: absolute; inset: 0; background: var(--card-bg);
    border-radius: 16px; z-index: 10; display: flex; flex-direction: column;
    padding: 30px; text-align: left;
    transform: translateX(110%) scale(0.95);
    opacity: 0;
    transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1),
                opacity 0.5s ease;
  }
  .modal-overlay.active {
    transform: translateX(0) scale(1);
    opacity: 1;
  }

  .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .modal-title { font-size: 18px; font-weight: bold; color: white; }
  .close-btn { background: none; border: none; color: #aaa; cursor: pointer; padding: 5px; width: auto; font-size: 20px; }
  .close-btn:hover { color: white; }

  label { display: block; font-size: 11px; text-transform: uppercase; color: #aaa; font-weight: 700; margin-bottom: 6px; margin-top: 15px; }
  input {
    width: 100%; padding: 12px; background: #1e1f22; border: 1px solid #2b2d31;
    color: white; border-radius: 4px; box-sizing: border-box; outline: none;
    transition: border-color 0.2s; font-family: monospace;
  }
  input:focus { border-color: var(--accent); }
</style>
</head>
<body>

  <div class="main-container">
    <div class="icon-circle">
      <svg viewBox="0 0 24 24"><path d="M23 6c0-1.1-.9-2-2-2h-1l-2-2h-4L12 4H5c-1.1 0-2 .9-2 2v1H2v3h1v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-8h1V7h-1V6zm-4 12H5V7h14v11zM12 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
    </div>
    <h1>Connection Failed</h1>
    <p>We couldn't connect to Discord. You might need to configure a Proxy or check your internet connection.</p>

    <div class="btn-group">
      <button class="btn-primary" onclick="retry()">Retry Connection</button>
      <button class="btn-secondary" onclick="toggleSettings(true)">Network Settings</button>
    </div>

    <div class="modal-overlay" id="settings-modal">
      <div class="modal-header">
        <span class="modal-title">Network Config</span>
        <button class="close-btn" onclick="toggleSettings(false)">Ã—</button>
      </div>

      <p style="margin-bottom: 10px; font-size: 12px;">Configure emergency proxy settings to bypass restrictions.</p>

      <label>Proxy URL</label>
      <input id="proxy" placeholder="scheme://user:pass@host:port">

      <label>Custom DNS</label>
      <input id="dns" placeholder="e.g. 1.1.1.1">

      <div style="flex:1"></div>
      <button class="btn-primary" onclick="save()">Save & Restart</button>
    </div>
  </div>

  <script>
    function toggleSettings(show) {
      const el = document.getElementById('settings-modal');
      if(show) el.classList.add('active');
      else el.classList.remove('active');
    }

    async function retry() {
        if(window.pywebview && window.pywebview.api) {
            await window.pywebview.api.restart_application();
        }
    }

    async function save() {
       const dns = document.getElementById('dns').value;
       const proxy = document.getElementById('proxy').value;
       if(window.pywebview && window.pywebview.api) {
           await window.pywebview.api.save_config({dns, proxy});
           await window.pywebview.api.restart_application();
       }
    }

    async function waitForBridge() {
        let attempts = 0;
        while (!window.pywebview || !window.pywebview.api) {
            await new Promise(r => setTimeout(r, 100));
            attempts++;
            if (attempts > 50) break;
        }
        return (window.pywebview && window.pywebview.api);
    }

    async function init() {
        const ready = await waitForBridge();
        if (ready) {
            try {
                const cfg = await window.pywebview.api.get_config();
                if(cfg.dns) document.getElementById('dns').value = cfg.dns;
                if(cfg.proxy) document.getElementById('proxy').value = cfg.proxy;
            } catch(e) { console.error(e); }
        }
    }

    if (window.pywebview) init();
    window.addEventListener('pywebviewready', init);
  </script>
</body>
</html>